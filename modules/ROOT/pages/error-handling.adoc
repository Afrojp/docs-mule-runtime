= Error Handlers
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: error handling, exceptions, exception catching, exceptions

From a high-level perspective, errors that occur in Mule fall into one of two
categories: system errors and messaging errors.

== Messaging Errors

Mule throws a messaging error (a xref:mule-error-concept.adoc[Mule error])
whenever a problem occurs within a flow. To handle Mule errors, you can
set up xref:on-error-scope-concept.adoc[On Error] components inside the
scope-like Error Handler component. By default, any unhandled errors are logged
and propagated.

When a Mule Event that is getting processed through a Mule flow raises an error, the normal flow execution stops, and the process is transferred to the Error Handler component. Inside the Error Handler component, you set up On Error components to match error types and expressions. Within each On Error component, the error path you define can incorporate any number of event processors to handle the error as precisely as you want. The Error Handler component will route an error to the first On Error scope that matches
the error.

This figure shows what happens when an event processor throws a Mule error:

image::error-handling-39be7.png[]

You can override the default error handling behavior either per flow or within a flow. You can group a sequence of components together into a xref:try-scope-concept.adoc[Try Scope] to further override the flow's error handling behavior. The default Error Handler can also be customized with a reference to the desired handler in the app's configuration.

=== Global Error-Handling Configuration for Messaging Errors

The following XML example sets a default payload for all unhandled errors.

.Example: XML Configuration for the App
[source,xml,linenums]
----
<configuration defaultErrorHandler-ref="allErrorHandler"/>

<error-handler name="allErrorHandler">
    <on-error-continue>
        <set-payload value="#[error.description]"/>
    </on-error-continue>
</error-handler>
----

In the Studio UI, the global error-handling example looks like this:

image::error-handling-global.png[]

The example includes two main components, an Error Handler (`error-handler`)
with embedded components that are visible in the Studio canvas and a global
error-handling configuration, which is not visible in the canvas. The empty
flow in the UI example is present only to illustrate that the global error
configuration lies outside of any flow in the Mule app.

To set up the global error-handling example through the Studio UI, instead
of writing the configuration in XML markup:

. Drag the Error Handler component from the *Mule Palette* to the Studio canvas,
and name it *allErrorHandler*.
+
Notice that the component is not part of any flow.
+
. Drag the On Error Continue component into the Error Handler component.
. Drag a Set Payload component into the On Error Continue component.
+
Note that the Set Payload component is an example. You can other components,
such as a Logger, and you can write your own error message inside that
component. The Set Payload example uses a Mule variable for the error
description (see the `error` variable in
xref:dataweave-variables-context.adoc[Predefined Variables] for details).
+
. Create a global error-handing configuration that references *allErrorHandler*:
+
image::error-handling-global-type.png[]
+
.. In Studio, click *Global Elements* to open *Global Configuration Elements*.
+
*Global Elements* is located below the Studio canvas.
+
.. In *Global Configuration Elements*, click *Create* to open the
*Choose Global Type* dialog.
.. From the dialog, select *Global Configuration* --> *Configuration*, and then
click *OK* to open the *Configuration* dialog.
+
image::error-handling-global-config.png[]
+
.. From the select *Configuration* dialog, select *allErrorHandler* for the
*Default Error Handler* field, and click *OK*.
. Check that the XML configuration looks correct by clicking *Configuration XML*
(located below the Studio canvas).

=== Flow-Level Configuration for Handling Messaging Errors

Just as you can reference error handlers to specify the default, error handlers
can also be referenced from within flows. The following example sets up a
flow with an Error Handler that logs all errors through a reference:

.Example: XML Configuration for the App
[source,xml,linenums]
----
<error-handler name="loggingErrorHandler">
    <on-error-continue>
        <logger message="#['Error: ' ++ error.description ++ ', Payload: ' ++ payload]"/>
    </on-error-continue>
</error-handler>

<flow name="withSharedHandler">
    <http:request url="http://example.com"/>
    <error-handler ref="loggingErrorHandler"/>
</flow>
----

//TODO: question out to RODRO about whether we can config this via the Studio GUI.

== System Errors

Mule throws a system error when an exception occurs at the system level.

If no Mule Event is involved, the errors are handled by a system error handler.

A system error handler handles exceptions that occur:

* During application start-up.
* When a connection to an external system fails.

When a system error occurs, Mule sends an error notification to registered
listeners, logs the error, and if the error is caused by a connection failure,
executes a reconnection strategy.

System error handlers are not configurable in Mule.

== See Also

* xref:mule-error-concept.adoc[Mule Errors]
* xref:on-error-scope-concept.adoc[On-Error Error Handlers]
* xref:try-scope-concept.adoc[Try Scope]
