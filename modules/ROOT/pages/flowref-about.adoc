= Flow Reference Component
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: email, connector, send, retrieve, manage, match, matcher, smtp, pop3, imap

//Anypoint Studio, Design Center connector
[[short_description]]
Flow Reference routes the Mule event to another flow or sub-flow, and then routes it back within the same Mule application. This process enables you to treat the entire referenced flow like a single component in your current flow.

Flow Reference breaks up the Mule application into discrete and reusable units. For example, a flow that lists files on a regular basis might reference another flow that processes the output of the List operation. Instead of appending all the processing steps, you can append a Flow Reference that points to the processing flow.

The next diagram shows the order of processing when one flow references another. When the main flow is triggered, the Mule event travels through and executes the flow until the event reaches the Flow Reference. The event then travels through and executes the referenced flow from beginning to end, and then returns to the main flow.

image::flowref-about-8b5d1.png[]

== Configure a Flow Reference

To configure a Flow Reference component, follow these steps in Anypoint Studio:

. Drag the Flow Reference component from *Mule Palette* to the point in your flow where you want to create the call to the referenced flow:
+
image:mruntime-flow-ref-create.png[flow-ref-create]
. Open the Flow Reference properties and specify the flow you want to reference in *Flow name*:
+
image:mruntime-flow-ref-config.png[flow-ref-config]

== Enrich Content with a Flow Reference Target Variable

You can store the result of a Flow Reference call in a target variable by configuring the following fields in your Flow Reference properties:

* *Target*: Name of the variable that the Flow Reference creates to store the result of the processed payload.
* *Target Value*: An expression that evaluates against the operation's output, the result of this evaluation is stored in the defined target variable.

=== Considerations About Target Variable

Setting the `target` variable in a Flow Reference component causes the message to remain unchanged. This means that any modification to the payload or to the variables that occur in the referenced flow will revert once the referenced flow finishes executing its processors, returning the payload and variables to its original values.

On the other hand, if you do not define a `target` variable, any modification to the payload or to the variables that occurs in the referenced flow will persist after the referenced flow finishes its execution, changing the actual value of the payload and variables.

=== XML Example

The following XML code represents the project configured in the previous steps, and also defines target variable `flowReferenceVar` which stores the result of the secondary flow called by the Flow Reference component. This variable is then used from the main flow by logging `vars.flowReferenceVar`:

[source, xml, linenums]
----
<!-- Main flow -->
<flow name="mainFlow" >
  <http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="test"/>
  <set-payload value="Original payload" doc:name="Set Payload"  />
  <set-variable value="1" doc:name="Set myVar=1" variableName="myVar"/>
  <!-- Flow Reference component with target variable flowReferenceVar -->
  <flow-ref doc:name="secondaryFlow" name="secondaryFlow" target="flowReferenceVar"/>
  <logger level="INFO" doc:name="Log payload" message='#["Payload = " ++ payload]'/>
  <logger level="INFO" doc:name="Log myVar" message='#["myVar = " ++ vars.myVar]'/>
  <logger level="INFO" doc:name="Log flowReferenceVar" message='#["flowReferenceVar = " ++ vars.flowReferenceVar]'/>
</flow>
<!-- Secondary flow that is referenced from Main flow-->
<flow name="secondaryFlow" doc:id="044ece19-aa71-4fc9-ad34-8df655dd59a8" >
  <set-payload value="Modified payload" doc:name="Update Payload" />
  <set-variable value="2" doc:name="Update myVar=2" variableName="myVar"/>
</flow>
----

The following log represents the output of the example application after its execution:

----
INFO  LoggerMessageProcessor: Payload = Original payload
INFO  LoggerMessageProcessor: myVar =  1
INFO  LoggerMessageProcessor: flowReferenceVar =  Modified payload
----

If you remove `target="flowReferenceVar"` from the Flow Reference component, the application returns the following output:

----
INFO  LoggerMessageProcessor: Payload = Modified payload
INFO  LoggerMessageProcessor: myVar = 2
INFO  LoggerMessageProcessor: flowReferenceVar = null
----

The logs are shortened to improve readability.

== See Also

* xref:about-mule-event.adoc[Mule Events]
* xref:target-variables.adoc[Enrich Data with Target Variables]
* xref:transaction-management.adoc#tx_scopes_routers[How Transactions Affect Scopes and Routers]
