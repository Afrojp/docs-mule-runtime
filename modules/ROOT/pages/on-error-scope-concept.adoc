= On-Error Error Handlers
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

When an error occurs, an Error Handler component routes the error to the
first On-Error component (On Error Continue or On Error Propagate) configuration
that matches the Mule error, such as for HTTP:NOT_FOUND, DB:CONNECTIVITY, or ANY
(the default for all Mule errors). If no error handling is configured for the
error, the app follows a
xref:error-handling.adoc#default_error_handling[default error handling] process.

.Error Handling Components in Studio
image::error-handlers.png[width=75%]

On-Error components differ in the way they affect their _owner_,
that is, the Flow or Try scope where they are defined.

On Error Propagate::
Executes but propagates the error to a higher level, such as a containing
scope (for example, to a Flow that contains a Try scope where the error occurs)
or external flow containing a Flow Reference to the flow in which an error occurs.
The error breaks the owner's execution and propagates to that higher level,
causing a failure at that level. In addition, any transaction the owner handles
is rolled back.
+
image::error-handling-e77ec.png[]

On Error Continue::
Executes and uses the result of the execution as the result of its owner,
as if the owner completed the execution successfully. Any transaction the
owner handles is committed.

== Configuration and Use

In most cases, you configure On-Error components within the scope-like Error
Handler component. Though each flow can contain only one Error Handler, the
Error Handler can contain as many On-Error components as you require, and
each On-Error component can contain any number of other components, such as
Loggers.

Because the Error Handler component is built into Flow and Try
components, you can use On-Error components for errors that occur within the
scope of a flow or within a Try component. You can also use On-Error components
in a global Error Handler configuration that is referenced from a Flow component
or Try scope (see xref:error-handling.adoc#global_error_handler[Error Handlers]).

== Error Matching

When an error occurs in a Mule app, the first On-Error component configured
to handle that error can inspect the error and execute.

image:error-handlers-selected-types.png[]

* Matching: Importantly, On-Error components can perform matching
based on xref:mule-error-concept#error-types.adoc[error types] you select or
an expression (for advanced use cases). The list of selectable error types
depends on the module and connector operations within the flow or scope
to which the On-Error component applies.

* Matching expression:
You can perform error matching based on a `when` condition you define in an
On-Error component. For example, you might map the component to fatal errors,
which have error messages that contain the word "fatal":
+
`#[error.cause.message contains "fatal"]`

Note that matching and conditions are evaluated sequentially, in the order in
which the On-Error components reside in the Error Handler. So, for example, if
you want to handle specific HTTP errors in one way but handle all other errors
a different way, you need to provide an On-Error component configuration for
the HTTP errors first. To capture and handle the remaining errors in a different
way, you can set another On-Error component after that to ANY. Keep in mind that
without a explicit final path for ANY, default error handling takes place, so
the error is be logged and propagated.

[[flow_error_config]]
=== Error Handling within a Flow

Within a flow's built-in Error Handler component, you can set up one or more
On Error components to match error types and expressions. The following example
outlines the general structure for handling errors that occur within a given
flow. One flow uses On Error Continue (`on-error-continue`) in its Error Handler
component. The other flow uses On Error Propagate (`on-error-propagate`).

[source,xml,linenums]
----
<flow name="catch">
  <!-- flow logic -->
  <error-handler>
    <on-error-continue>
      <!-- error handling logic -->
    </on-error-continue>
  </error-handler>
</flow>

<flow name="rollback">
  <!-- flow logic -->
  <error-handler>
    <on-error-propagate>
      <!-- error handling logic -->
    </on-error-propagate>
  </error-handler>
</flow>
----

=== Reuse of On-Error Scopes

Just like error handlers can be shared by exposing them globally and referencing them
in flows and try scopes, on-error scopes can be reused as well. You can define and name
an on-error scope globally and then reference it using a reference on-error component as
in the example below.

.Example: XML Configuration for Referenced On-Error
[source,xml,linenums]
----
<on-error-propagate name="sharedPropagateHandler">
  <logger message="An unhandled error has occurred."/>
</on-error-propagate>

<on-error-continue type="EXPRESSION" name="sharedContinueHandler">
  <logger message="An expression failed to evaluate."/>
</on-error-continue>

<error-handler name="reusingHandlers">
  <on-error ref="sharedContinueHandler"/>
  <on-error-continue type="ROUTING">
    <logger message="An expression failed to evaluate."/>
  </on-error-continue>
  <on-error ref="sharedPropagateHandler"/>
</error-handler>
----

== Examples

The following examples show uses of On-Error components:

* xref:error-handling.adoc#on_error_continue[Using On-Error Components to Handle Messaging Errors].
* xref:error-handling.adoc#global_error_handler[Referencing a Global Error Handler].


== See Also

* xref:mule-error-concept.adoc[Mule Errors]
* xref:try-scope-concept.adoc[Try Scope]
