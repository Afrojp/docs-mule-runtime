= REST API Examples
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

These examples of consuming REST APIs show you how to perform typical tasks using Anypoint Studio or a standalone XML in Mule Runtime:

* <<consuming-a-rest-api-studio,Consuming a REST API>>
+
Describes how to write an API that retrieves data from a publicly available REST API
+
* <<extracting-and-storing-xml-data-from-a-rest-api-studio,Extracting and Storing XML Data from a REST API>>
+
Covers retrieving data from a Yahoo REST API and inserting the data in a local Postgres database

== Overview of Consuming a REST API--Studio

This example queries the Bacon Ipsum REST API at:

----
http://baconipsum.com/
----

This API generates xref:https://en.wikipedia.org/wiki/Lorem_ipsum[lorem ipsum text]. You donâ€™t have to use HTTPS or set up an account. Initially, you add and configure an HTTP listener and an HTTP requester:

image::rest-api-example-1.png[]

At this point, you can call the API and receive bacon ipsum text in the browser. Next, you add a File component to the example to save the output of the request for lorem ipsum text to a file on your file system.

image::rest-api-example-2.png[]

The first element, an HTTP listener, listens on localhost port 8081 (the default) for incoming GET requests. Calling the listener from a browser triggers the flow. Use the following syntax for requests:

----
http://localhost:8081?<query>
----

The `<query>` consists of the parameters accepted by the REST API. When the HTTP listener receives the HTTP request, the application records `<query>` as a set of query parameters. The HTTP listener passes these parameters to the next element in the flow, the HTTP request operation. This operation is configured to query the remote REST API at `http://baconipsum.com/api`. The HTTP request connector uses DataWeave expressions to extract the query parameters from the properties in the message, and constructs the full URL for the remote API, including the query parameters.


For example, you enter this local browser request: `http://localhost:8081?type=meat-and-filler`.

The application issues this query: `http://baconipsum.com/api/?type=meat-and-filler`.

Follow the procedures in subsequent sections to create and run the example.

=== Configuring the HTTP Connectors

You need to specify how to call the API and what to return by configuring the HTTP Listener and HTTP requester.

==== HTTP Listener

. Select the HTTP listener component.
. In *Connector Configuration*, click image:add.png[], and set up the *Host* and *Port*:
+
image::rest-api-example-3.png[]
+
. In the properties editor, set the *Path* to `/`:
+
image::rest-api-example-4.png[]
+

[%header%autowidth.spread]
|===
|Parameter |Value
|*Name* |`HTTP_Listener_Configuration`
|*Host* |`localhost`
|*Port* |`8081`
|===

==== HTTP Request Connector

. In *Connector Configuration*, click image:add.png[], and set up the *Host*, *Port*, and *Base Path*:
+
image::rest-api-example-5.png[]
+
[%header%autowidth.spread]
|===
|Parameter |Value
|*Name* |`HTTP_Request_Connector`
|*Host* |`baconipsum.com`
|*Port* | `80`
|*Base Path* |`api`
|===
+
This configuration sends requests to http://baconipsum.com/api.
+
. Click OK.
. In the properties editor, set up the path and method:
+
[%header%autowidth.spread]
|===
|Parameter |Value
|*Path* |`/`
|*Method* |`GET`
|===
+
. Add two query parameters in the Query Parameters tab. For the `value` field of each, write a mule expression that takes the specified value from the query parameters of the request that first reaches the HTTP Listener.
+
[%header%autowidth.spread]
|===
|Parameter |Value
|*Type* |`query-param`
|*Name* |`type`
|*Value* |`#[message.attributes.queryParams['type']]`
|===
+
[%header%autowidth.spread]
|===
|Parameter |Value
|*Type* |`query-param`
|*Name* |`sentences`
|*Value* |`#[message.attributes.queryParams['senteces']]
|===
+
image::rest-api-example-6.png[]
+

The Bacon Ipsum API page contains a list of parameters you can use, but this application uses only *type* and *sentences*. An example of a valid value for type is `meat-and-filler`, as shown later. The optional `sentences` parameter determines the number of sentences to return in the JSON response.

=== File Write Operation

Set up the File connector properties to save the output of this application to a file.

. Drag a File write operation onto the canvas.
. In the properties editor, set the directory and file name for storing the output: `/tmp/output`
+
image::rest-api-example-2.png[]
+
. In the properties editor, specify any actual path on your file system for *Path*.
+
image::rest-api-example-7.png[]

=== Running the Application to Consume a REST API

. Run the example as a Mule application.
. To trigger the flow in this application, use a Web browser to query the HTTP listener on localhost port 8081: `http://localhost:8081?type=meat-and-filler`

The Bacon Ipsum API page contains a list of parameters you can use, but when configuring the HTTP request connector, you set up your connector to use only *type* and *sentences*. The first parameter=value pair must be preceded by the `?` operator. To insert additional parameter=value pairs, use the `&` operator. Example queries you can send to the HTTP listener on localhost port 8081 are:

----
http://localhost:8081?type=meat-and-filler
http://localhost:8081?sentences=2
http://localhost:8081?type=all-meat&sentences=3
----

The `type=meat-and-filler` example returns the output shown below.

----
["Doner ullamco ea non, porchetta incididunt brisket ball tip in chuck ex bresaola beef tongue.  Et aute ham hock kielbasa chuck fatback short ribs.  Kevin in reprehenderit est esse, ham bacon ut ball tip.  Laborum ut nulla ex irure t-bone flank, biltong cupidatat venison proident aliquip pork belly ham hock.  In consequat proident, cillum labore pariatur nisi.  Reprehenderit boudin beef ribs, frankfurter cillum enim pork loin consectetur kielbasa laboris.  Hamburger prosciutto nisi, jerky biltong ex pork chop venison.","Fatback tongue anim, irure ut ut cupidatat occaecat eiusmod ham hock laborum commodo.  Anim pig shank kielbasa, drumstick corned beef esse nostrud ham salami id laborum ribeye aute.  Duis pancetta sunt magna occaecat dolor leberkas, short loin meatloaf flank enim pastrami.  Prosciutto proident landjaeger deserunt tenderloin short loin.  Adipisicing aute in bresaola meatball, ut frankfurter pastrami shoulder porchetta turducken strip steak doner.  In filet mignon bresaola, sed deserunt pariatur eu mollit commodo shankle laborum.  Andouille aliqua jowl pork chop jerky sed consequat turkey voluptate bacon pastrami.","Ground round elit boudin reprehenderit.  Brisket shankle esse, leberkas veniam andouille rump proident drumstick.  Consequat sausage do ut prosciutto nostrud andouille tongue ullamco bacon est exercitation.  Do fugiat biltong est tempor short ribs reprehenderit adipisicing shoulder.  Tail venison shank incididunt, hamburger adipisicing voluptate corned beef fugiat sirloin fatback in tri-tip nisi ut.  Tail non excepteur, fugiat veniam corned beef dolore ex pig pork belly sint mollit chuck pork.","Pig hamburger dolore proident brisket landjaeger in boudin kielbasa ut elit.  Velit incididunt boudin qui.  Fatback anim adipisicing, pig jowl voluptate sirloin drumstick chicken esse.  Strip steak consequat tenderloin pastrami, ullamco brisket hamburger bacon beef adipisicing.  Tri-tip ham hock eu non et, flank dolore kevin.  Et duis frankfurter, ut ullamco do non quis boudin andouille aliqua venison ham.  Ut aliqua shoulder, aliquip pariatur bacon spare ribs irure.","Aliqua jerky frankfurter, swine ham in ground round sed qui laborum cow.  Sint turducken shank ut ea id.  Kevin dolore pig excepteur, anim ut magna.  Enim consequat short ribs corned beef ham hock nostrud fugiat chuck.  Tail spare ribs dolore boudin, andouille incididunt laboris occaecat strip steak.  Cow frankfurter capicola, landjaeger cupidatat porchetta ad ground round voluptate."]
----

== Consuming a REST API--Standalone XML

=== Procedure

Configure the HTTP listener connector as follows:

[source,xml,linenums]
----
<http:listener config-ref="HTTP_Listener_config" path="/"/>
----

You reference an abstract element called a *Connector Configuration*, which contains several of the high level necessary configuration properties. The **config-ref** attribute in the connector references this connector configuration element. You must now create an element outside the flow that matches the referenced name.

[source,xml,linenums]
----
<http:listener-config name="HTTP_Listener_config">
	<http:listener-connection host="0.0.0.0" port="8081" />
</http:listener-config>
----

Configure the HTTP request operation as follows:

[source,xml,linenums]
----
<http:request method="GET" config-ref="HTTP_Request_configuration" path="/">
	<http:query-params >
		<![CDATA[#[output application/java
			---
			{
				"type" : message.attributes.queryParams['type'],
				"sentences" : message.attributes.queryParams['sentences']
			}
		]]]>
	</http:query-params>
</http:request>
----

You reference an abstract element called a *Connector Configuration*, which contains several of the high level necessary configuration properties. The **config-ref **attribute in the connector references this connector configuration element. You must now create an element outside the flow that matches the referenced name.

[source,xml,linenums]
----
<http:request-config name="HTTP_Request_configuration" basePath="/api">
		<http:request-connection host="baconipsum.com" port="80"/>
	</http:request-config>
----

Finally, add the file component.

[source,xml,linenums]
----
<file:write path="/Users/max/output.txt"/>
----

=== XML

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd">
	<http:request-config name="HTTP_Request_configuration" basePath="/api">
		<http:request-connection host="baconipsum.com" port="80"/>
	</http:request-config>
	<http:listener-config name="HTTP_Listener_config">
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>

	<flow name="consumeRestAPI">
		<http:listener config-ref="HTTP_Listener_config" path="/"/>
		<http:request method="GET" config-ref="HTTP_Request_configuration" path="/">
			<http:query-params ><![CDATA[#[output application/java
				---
				{
					"type" : message.attributes.queryParams['type'],
					"sentences" : message.attributes.queryParams['sentences']
				}]]]>
			</http:query-params>
		</http:request>
		<file:write path="/Users/max/output.txt"/>
	</flow>
</mule>
----

